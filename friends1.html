<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Punk Zen Temple</title>
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Vast+Shadow&display=swap" rel="stylesheet" />
  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
      font-family: 'Press Start 2P', cursive;
      color: white;
      overflow-y: auto;
      height: 100vh;
    }
    .background-shapes {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 0;
    }
    .shape {
      position: absolute;
      border-radius: 50%;
      animation: float 10s infinite linear;
    }
    @keyframes float {
      0% { transform: translateY(0) rotate(0deg); }
      100% { transform: translateY(-100vh) rotate(360deg); }
    }
    .container {
      position: relative;
      z-index: 1;
      text-align: center;
      padding: 20px;
      max-width: 1200px;
      margin: auto;
    }
    /* Tabs */
    .tabs {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .tab-button {
      padding: 10px 20px;
      background: #333;
      color: white;
      border: 2px solid #f0f;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
      margin: 0 5px;
    }
    .tab-button.active {
      background: #f0f;
      color: #000;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    /* Avatar & headline */
    #user-avatar {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px auto;
      position: relative;
    }
    #avatar-img {
      width: 100px;
      height: 100px;
      border-radius: 50%;
    }
    #avatar-title {
      font-family: 'Vast Shadow', cursive;
      color: #f0f;
      margin-top: 10px;
      font-size: 1.2em;
      text-shadow: 2px 2px #000;
    }
    /* Drawers */
    .drawer {
      position: fixed;
      top: 0;
      height: 100%;
      width: 300px;
      background: rgba(0,0,0,0.9);
      border: 2px solid #f0f;
      z-index: 10;
      transition: transform 0.3s ease;
      overflow-y: auto;
      padding: 20px;
    }
    #left-drawer {
      left: -300px;
      transform: translateX(0);
    }
    #left-drawer.open {
      transform: translateX(300px);
    }
    #right-drawer {
      right: -300px;
      transform: translateX(0);
    }
    #right-drawer.open {
      transform: translateX(-300px);
    }
    .drawer-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 9;
      display: none;
    }
    .drawer-overlay.show {
      display: block;
    }
    .friend-circle {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #333;
      margin: 10px;
      display: inline-block;
      position: relative;
      cursor: pointer;
    }
    .friend-circle img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    .online-dot {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 10px;
      height: 10px;
      background: lime;
      border-radius: 50%;
    }
    /* Modal */
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 11;
      display: none;
      justify-content: center;
      align-items: center;
    }
    .modal.show {
      display: flex;
    }
    .modal-content {
      background: #000;
      border: 2px solid #f0f;
      padding: 20px;
      max-width: 500px;
      width: 90%;
      text-align: left;
    }
    .close-btn {
      float: right;
      cursor: pointer;
      font-size: 1.5em;
    }
    /* Auth buttons */
    #auth-buttons {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    #auth-buttons button {
      margin: 0;
      padding: 10px 20px;
      background: #f0f;
      color: white;
      border: none;
      cursor: pointer;
      font-family: 'Press Start 2P', cursive;
    }
    /* Panels */
    .paper {
      background: rgba(0,0,0,0.8);
      border: 2px solid #f0f;
      padding: 20px;
      margin: 20px auto;
      max-width: 800px;
    }
    #signup-message {
      color: lime;
      font-weight: bold;
      margin-top: 10px;
    }
    /* Chalkboard notes */
    #chalkboard {
      background: #1e2f1e;
      border: 3px dashed #ccc;
      padding: 15px;
    }
    #notes-board {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
    }
    .note {
      width: 150px;
      min-height: 120px;
      padding: 10px;
      background: #ffeb3b;
      color: #000;
      font-size: 0.6em;
      box-shadow: 4px 4px 0 rgba(0,0,0,0.4);
      transform: rotate(var(--rot));
      position: relative;
      cursor: pointer;
    }
    .note-actions {
      margin-top: 10px;
      font-size: 0.5em;
    }
    .note-actions button {
      margin: 0 5px;
      padding: 5px;
      font-size: 0.5em;
    }
    /* Shoutbox */
    #shoutbox {
      max-height: 300px;
      overflow-y: auto;
      background: #111;
      border: 1px solid #f0f;
      padding: 10px;
      margin-top: 10px;
    }
    .shout {
      margin: 5px 0;
      padding: 5px;
      background: #222;
      border-left: 3px solid #f0f;
    }
    /* Forms */
    textarea, input {
      padding: 10px;
      font-family: 'Press Start 2P';
      width: 90%;
      margin: 5px 0;
    }
    button {
      padding: 10px 15px;
      cursor: pointer;
      background: #f0f;
      color: #000;
      border: none;
      font-family: 'Press Start 2P';
    }
    /* Responsive */
    @media (max-width: 768px) {
      .note { width: 100%; }
      .tabs { flex-direction: column; }
      .drawer { width: 250px; }
    }
  </style>
</head>
<body>
  <div class="background-shapes" id="shapes"></div>
  <!-- Drawers -->
  <div class="drawer-overlay" id="drawer-overlay" onclick="closeDrawers()"></div>
  <div class="drawer" id="left-drawer">
    <h3>Friends</h3>
    <div id="friends-list">
      <div class="friend-circle" onclick="openUserModal(null)"></div>
      <div class="friend-circle" onclick="openUserModal(null)"></div>
      <div class="friend-circle" onclick="openUserModal(null)"></div>
      <div class="friend-circle" onclick="openUserModal(null)"></div>
    </div>
  </div>
  <div class="drawer" id="right-drawer">
    <h3>Active Users</h3>
    <div id="active-users-list"></div>
  </div>
  <!-- Modal -->
  <div class="modal" id="modal">
    <div class="modal-content">
      <span class="close-btn" onclick="closeModal()">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
  <div class="container">
    <!-- Avatar + headline -->
    <div id="user-avatar">
      <button onclick="toggleLeftDrawer()" style="position:absolute; left:10px; top:10px;">Friends</button>
      <img id="avatar-img" src="officialsticker.png" alt="User Avatar">
      <div id="avatar-title">Punk Zen Temple</div>
      <button id="logout-btn" onclick="logout()" style="margin-top:10px; padding:5px 10px; font-family:'Press Start 2P'; cursor:pointer; display:none;">Log Out</button>
      <span id="tea-icon" onclick="toggleRightDrawer()" style="position:absolute; right:10px; top:10px; cursor:pointer; font-size:2em;">â˜•</span>
    </div>
    <!-- Auth buttons -->
    <div id="auth-buttons">
      <button onclick="showSignUp()">Sign Up</button>
      <button onclick="showSignIn()">Log In</button>
    </div>
    <!-- Auth form -->
    <div class="paper" id="auth-form" style="display:none;">
      <h2 style="font-family:'Vast Shadow',cursive;">Enter the Temple</h2>
      <input type="email" id="auth-email" placeholder="Email" /><br>
      <input type="password" id="auth-password" placeholder="Password" /><br>
      <button onclick="submitAuth()">Submit</button>
      <button onclick="cancelAuth()">Cancel</button>
      <div id="signup-message"></div>
    </div>
    <!-- Main content with tabs -->
    <div id="main-content" style="display:none;">
      <div class="tabs">
        <button class="tab-button active" onclick="showTab('wall')">Communal Wall</button>
        <button class="tab-button" onclick="showTab('den')">Zen Den</button>
        <button class="tab-button" onclick="showTab('profile')">Profile</button>
      </div>
      <!-- Communal Wall Tab -->
      <div id="wall-tab" class="tab-content active">
        <div class="paper" id="chalkboard">
          <h2 style="font-family:'Vast Shadow',cursive;">Communal Wall</h2>
          <input type="text" id="search-notes" placeholder="Search notes..." oninput="filterNotes()" />
          <div id="notes-board"></div>
          <textarea id="note-input" placeholder="Share your zen..."></textarea>
          <input type="text" id="note-tags" placeholder="Tags (e.g., #Zen #Punk)" />
          <button onclick="postNote()">Post It</button>
        </div>
        <div class="paper">
          <h3>Shoutbox</h3>
          <div id="shoutbox"></div>
          <textarea id="shout-input" placeholder="Shout something..."></textarea>
          <button onclick="postShout()">Shout</button>
        </div>
      </div>
      <!-- Zen Den Tab (Personal Space) -->
      <div id="den-tab" class="tab-content">
        <div class="paper">
          <h2 style="font-family:'Vast Shadow',cursive;">Your Zen Den</h2>
          <p>Private reflections and drafts. Only you can see these.</p>
          <div id="personal-notes"></div>
          <textarea id="personal-note-input" placeholder="Meditate here..."></textarea>
          <button onclick="postPersonalNote()">Save to Den</button>
        </div>
      </div>
      <!-- Profile Tab -->
      <div id="profile-tab" class="tab-content">
        <div class="paper">
          <h3>Edit Profile</h3>
          <input id="profile-username" placeholder="Username" />
          <input id="social-link" placeholder="Your social link" />
          <input id="avatar-url" placeholder="Avatar URL" />
          <textarea id="profile-bio" placeholder="Short bio..."></textarea>
          <button onclick="saveProfile()">Save Profile</button>
        </div>
      </div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      // Floating shapes
      const shapesContainer = document.getElementById('shapes');
      for (let i = 0; i < 20; i++) {
        const shape = document.createElement('div');
        shape.className = 'shape';
        const size = 10 + Math.random() * 30;
        shape.style.width = shape.style.height = size + 'px';
        shape.style.top = Math.random() * 100 + '%';
        shape.style.left = Math.random() * 100 + '%';
        shape.style.background = 'linear-gradient(45deg,#f0f,#0ff,#ff0)';
        shape.style.transform = `rotate(${Math.random() * 360}deg)`;
        shape.style.animationDuration = (10 + Math.random() * 20) + 's';
        shapesContainer.appendChild(shape);
      }

      // Supabase
      const supabaseUrl = 'https://hwymepujsvfqjkbullaf.supabase.co';
      const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh3eW1lcHVqc3ZmcWprYnVsbGFmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg3MDczOTQsImV4cCI6MjA4NDI4MzM5NH0.V6-Cm331IocSXDqe-v6iAZA3TV1STyEHyQI43lcXU_4';
      window.supabase = supabase.createClient
